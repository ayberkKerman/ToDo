{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.WSSecurityCert = void 0;\n\nvar uuid_1 = require(\"uuid\");\n\nvar xml_crypto_1 = require(\"xml-crypto\");\n\nfunction addMinutes(date, minutes) {\n  return new Date(date.getTime() + minutes * 60000);\n}\n\nfunction dateStringForSOAP(date) {\n  return date.getUTCFullYear() + '-' + ('0' + (date.getUTCMonth() + 1)).slice(-2) + '-' + ('0' + date.getUTCDate()).slice(-2) + 'T' + ('0' + date.getUTCHours()).slice(-2) + ':' + ('0' + date.getUTCMinutes()).slice(-2) + ':' + ('0' + date.getUTCSeconds()).slice(-2) + 'Z';\n}\n\nfunction generateCreated() {\n  return dateStringForSOAP(new Date());\n}\n\nfunction generateExpires() {\n  return dateStringForSOAP(addMinutes(new Date(), 10));\n}\n\nfunction insertStr(src, dst, pos) {\n  return [dst.slice(0, pos), src, dst.slice(pos)].join('');\n}\n\nfunction generateId() {\n  return uuid_1.v4().replace(/-/gm, '');\n}\n\nfunction resolvePlaceholderInReferences(references, bodyXpath) {\n  for (var _i = 0, references_1 = references; _i < references_1.length; _i++) {\n    var ref = references_1[_i];\n\n    if (ref.xpath === bodyXpathPlaceholder) {\n      ref.xpath = bodyXpath;\n    }\n  }\n}\n\nvar oasisBaseUri = 'http://docs.oasis-open.org/wss/2004/01';\nvar bodyXpathPlaceholder = '[[bodyXpath]]';\n\nvar WSSecurityCert =\n/** @class */\nfunction () {\n  function WSSecurityCert(privatePEM, publicP12PEM, password, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.signerOptions = {};\n    this.additionalReferences = [];\n    this.publicP12PEM = publicP12PEM.toString().replace('-----BEGIN CERTIFICATE-----', '').replace('-----END CERTIFICATE-----', '').replace(/(\\r\\n|\\n|\\r)/gm, '');\n    this.signer = new xml_crypto_1.SignedXml();\n\n    if (options.signatureAlgorithm === 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256') {\n      this.signer.signatureAlgorithm = options.signatureAlgorithm;\n      this.signer.addReference(bodyXpathPlaceholder, ['http://www.w3.org/2001/10/xml-exc-c14n#'], 'http://www.w3.org/2001/04/xmlenc#sha256');\n    }\n\n    if (options.additionalReferences && options.additionalReferences.length > 0) {\n      this.additionalReferences = options.additionalReferences;\n    }\n\n    if (options.signerOptions) {\n      var signerOptions = options.signerOptions;\n      this.signerOptions = signerOptions;\n\n      if (!this.signerOptions.existingPrefixes) {\n        this.signerOptions.existingPrefixes = {};\n      }\n\n      if (this.signerOptions.existingPrefixes && !this.signerOptions.existingPrefixes.wsse) {\n        this.signerOptions.existingPrefixes.wsse = oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\";\n      }\n    } else {\n      this.signerOptions = {\n        existingPrefixes: {\n          wsse: oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\n        }\n      };\n    }\n\n    this.signer.signingKey = {\n      key: privatePEM,\n      passphrase: password\n    };\n    this.x509Id = \"x509-\" + generateId();\n    this.hasTimeStamp = typeof options.hasTimeStamp === 'undefined' ? true : !!options.hasTimeStamp;\n    this.signatureTransformations = Array.isArray(options.signatureTransformations) ? options.signatureTransformations : ['http://www.w3.org/2000/09/xmldsig#enveloped-signature', 'http://www.w3.org/2001/10/xml-exc-c14n#'];\n    this.signer.keyInfoProvider = {};\n\n    this.signer.keyInfoProvider.getKeyInfo = function (key) {\n      return \"<wsse:SecurityTokenReference>\" + (\"<wsse:Reference URI=\\\"#\" + _this.x509Id + \"\\\" ValueType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-x509-token-profile-1.0#X509v3\\\"/>\") + \"</wsse:SecurityTokenReference>\";\n    };\n  }\n\n  WSSecurityCert.prototype.postProcess = function (xml, envelopeKey) {\n    this.created = generateCreated();\n    this.expires = generateExpires();\n    var timestampStr = '';\n\n    if (this.hasTimeStamp) {\n      timestampStr = \"<Timestamp xmlns=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-utility-1.0.xsd\\\" Id=\\\"_1\\\">\" + (\"<Created>\" + this.created + \"</Created>\") + (\"<Expires>\" + this.expires + \"</Expires>\") + \"</Timestamp>\";\n    }\n\n    var secHeader = \"<wsse:Security xmlns:wsse=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\\\" \" + (\"xmlns:wsu=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-utility-1.0.xsd\\\" \") + (envelopeKey + \":mustUnderstand=\\\"1\\\">\") + \"<wsse:BinarySecurityToken \" + (\"EncodingType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-soap-message-security-1.0#Base64Binary\\\" \") + (\"ValueType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-x509-token-profile-1.0#X509v3\\\" \") + (\"wsu:Id=\\\"\" + this.x509Id + \"\\\">\" + this.publicP12PEM + \"</wsse:BinarySecurityToken>\") + timestampStr + \"</wsse:Security>\";\n    var xmlWithSec = insertStr(secHeader, xml, xml.indexOf(\"</\" + envelopeKey + \":Header>\"));\n    var references = this.signatureTransformations;\n    var bodyXpath = \"//*[name(.)='\" + envelopeKey + \":Body']\";\n    resolvePlaceholderInReferences(this.signer.references, bodyXpath);\n\n    if (!(this.signer.references.filter(function (ref) {\n      return ref.xpath === bodyXpath;\n    }).length > 0)) {\n      this.signer.addReference(bodyXpath, references);\n    }\n\n    var _loop_1 = function (name_1) {\n      var xpath = \"//*[name(.)='\" + name_1 + \"']\";\n\n      if (!(this_1.signer.references.filter(function (ref) {\n        return ref.xpath === xpath;\n      }).length > 0)) {\n        this_1.signer.addReference(xpath, references);\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, _a = this.additionalReferences; _i < _a.length; _i++) {\n      var name_1 = _a[_i];\n\n      _loop_1(name_1);\n    }\n\n    var timestampXpath = \"//*[name(.)='wsse:Security']/*[local-name(.)='Timestamp']\";\n\n    if (this.hasTimeStamp && !(this.signer.references.filter(function (ref) {\n      return ref.xpath === timestampXpath;\n    }).length > 0)) {\n      this.signer.addReference(timestampXpath, references);\n    }\n\n    this.signer.computeSignature(xmlWithSec, this.signerOptions);\n    return insertStr(this.signer.getSignatureXml(), xmlWithSec, xmlWithSec.indexOf('</wsse:Security>'));\n  };\n\n  return WSSecurityCert;\n}();\n\nexports.WSSecurityCert = WSSecurityCert;","map":{"version":3,"names":["exports","__esModule","WSSecurityCert","uuid_1","require","xml_crypto_1","addMinutes","date","minutes","Date","getTime","dateStringForSOAP","getUTCFullYear","getUTCMonth","slice","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","generateCreated","generateExpires","insertStr","src","dst","pos","join","generateId","v4","replace","resolvePlaceholderInReferences","references","bodyXpath","_i","references_1","length","ref","xpath","bodyXpathPlaceholder","oasisBaseUri","privatePEM","publicP12PEM","password","options","_this","signerOptions","additionalReferences","toString","signer","SignedXml","signatureAlgorithm","addReference","existingPrefixes","wsse","signingKey","key","passphrase","x509Id","hasTimeStamp","signatureTransformations","Array","isArray","keyInfoProvider","getKeyInfo","prototype","postProcess","xml","envelopeKey","created","expires","timestampStr","secHeader","xmlWithSec","indexOf","filter","_loop_1","name_1","this_1","_a","timestampXpath","computeSignature","getSignatureXml"],"sources":["C:/Users/ayber/node_modules/soap/lib/security/WSSecurityCert.js"],"sourcesContent":["\"use strict\";\nexports.__esModule = true;\nexports.WSSecurityCert = void 0;\nvar uuid_1 = require(\"uuid\");\nvar xml_crypto_1 = require(\"xml-crypto\");\nfunction addMinutes(date, minutes) {\n    return new Date(date.getTime() + minutes * 60000);\n}\nfunction dateStringForSOAP(date) {\n    return date.getUTCFullYear() + '-' + ('0' + (date.getUTCMonth() + 1)).slice(-2) + '-' +\n        ('0' + date.getUTCDate()).slice(-2) + 'T' + ('0' + date.getUTCHours()).slice(-2) + ':' +\n        ('0' + date.getUTCMinutes()).slice(-2) + ':' + ('0' + date.getUTCSeconds()).slice(-2) + 'Z';\n}\nfunction generateCreated() {\n    return dateStringForSOAP(new Date());\n}\nfunction generateExpires() {\n    return dateStringForSOAP(addMinutes(new Date(), 10));\n}\nfunction insertStr(src, dst, pos) {\n    return [dst.slice(0, pos), src, dst.slice(pos)].join('');\n}\nfunction generateId() {\n    return uuid_1.v4().replace(/-/gm, '');\n}\nfunction resolvePlaceholderInReferences(references, bodyXpath) {\n    for (var _i = 0, references_1 = references; _i < references_1.length; _i++) {\n        var ref = references_1[_i];\n        if (ref.xpath === bodyXpathPlaceholder) {\n            ref.xpath = bodyXpath;\n        }\n    }\n}\nvar oasisBaseUri = 'http://docs.oasis-open.org/wss/2004/01';\nvar bodyXpathPlaceholder = '[[bodyXpath]]';\nvar WSSecurityCert = /** @class */ (function () {\n    function WSSecurityCert(privatePEM, publicP12PEM, password, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        this.signerOptions = {};\n        this.additionalReferences = [];\n        this.publicP12PEM = publicP12PEM.toString()\n            .replace('-----BEGIN CERTIFICATE-----', '')\n            .replace('-----END CERTIFICATE-----', '')\n            .replace(/(\\r\\n|\\n|\\r)/gm, '');\n        this.signer = new xml_crypto_1.SignedXml();\n        if (options.signatureAlgorithm === 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256') {\n            this.signer.signatureAlgorithm = options.signatureAlgorithm;\n            this.signer.addReference(bodyXpathPlaceholder, ['http://www.w3.org/2001/10/xml-exc-c14n#'], 'http://www.w3.org/2001/04/xmlenc#sha256');\n        }\n        if (options.additionalReferences && options.additionalReferences.length > 0) {\n            this.additionalReferences = options.additionalReferences;\n        }\n        if (options.signerOptions) {\n            var signerOptions = options.signerOptions;\n            this.signerOptions = signerOptions;\n            if (!this.signerOptions.existingPrefixes) {\n                this.signerOptions.existingPrefixes = {};\n            }\n            if (this.signerOptions.existingPrefixes && !this.signerOptions.existingPrefixes.wsse) {\n                this.signerOptions.existingPrefixes.wsse = oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\";\n            }\n        }\n        else {\n            this.signerOptions = { existingPrefixes: { wsse: oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\" } };\n        }\n        this.signer.signingKey = {\n            key: privatePEM,\n            passphrase: password\n        };\n        this.x509Id = \"x509-\" + generateId();\n        this.hasTimeStamp = typeof options.hasTimeStamp === 'undefined' ? true : !!options.hasTimeStamp;\n        this.signatureTransformations = Array.isArray(options.signatureTransformations) ? options.signatureTransformations\n            : ['http://www.w3.org/2000/09/xmldsig#enveloped-signature', 'http://www.w3.org/2001/10/xml-exc-c14n#'];\n        this.signer.keyInfoProvider = {};\n        this.signer.keyInfoProvider.getKeyInfo = function (key) {\n            return \"<wsse:SecurityTokenReference>\" +\n                (\"<wsse:Reference URI=\\\"#\" + _this.x509Id + \"\\\" ValueType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-x509-token-profile-1.0#X509v3\\\"/>\") +\n                \"</wsse:SecurityTokenReference>\";\n        };\n    }\n    WSSecurityCert.prototype.postProcess = function (xml, envelopeKey) {\n        this.created = generateCreated();\n        this.expires = generateExpires();\n        var timestampStr = '';\n        if (this.hasTimeStamp) {\n            timestampStr =\n                \"<Timestamp xmlns=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-utility-1.0.xsd\\\" Id=\\\"_1\\\">\" +\n                    (\"<Created>\" + this.created + \"</Created>\") +\n                    (\"<Expires>\" + this.expires + \"</Expires>\") +\n                    \"</Timestamp>\";\n        }\n        var secHeader = \"<wsse:Security xmlns:wsse=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-secext-1.0.xsd\\\" \" +\n            (\"xmlns:wsu=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-wssecurity-utility-1.0.xsd\\\" \") +\n            (envelopeKey + \":mustUnderstand=\\\"1\\\">\") +\n            \"<wsse:BinarySecurityToken \" +\n            (\"EncodingType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-soap-message-security-1.0#Base64Binary\\\" \") +\n            (\"ValueType=\\\"\" + oasisBaseUri + \"/oasis-200401-wss-x509-token-profile-1.0#X509v3\\\" \") +\n            (\"wsu:Id=\\\"\" + this.x509Id + \"\\\">\" + this.publicP12PEM + \"</wsse:BinarySecurityToken>\") +\n            timestampStr +\n            \"</wsse:Security>\";\n        var xmlWithSec = insertStr(secHeader, xml, xml.indexOf(\"</\" + envelopeKey + \":Header>\"));\n        var references = this.signatureTransformations;\n        var bodyXpath = \"//*[name(.)='\" + envelopeKey + \":Body']\";\n        resolvePlaceholderInReferences(this.signer.references, bodyXpath);\n        if (!(this.signer.references.filter(function (ref) { return (ref.xpath === bodyXpath); }).length > 0)) {\n            this.signer.addReference(bodyXpath, references);\n        }\n        var _loop_1 = function (name_1) {\n            var xpath = \"//*[name(.)='\" + name_1 + \"']\";\n            if (!(this_1.signer.references.filter(function (ref) { return (ref.xpath === xpath); }).length > 0)) {\n                this_1.signer.addReference(xpath, references);\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, _a = this.additionalReferences; _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            _loop_1(name_1);\n        }\n        var timestampXpath = \"//*[name(.)='wsse:Security']/*[local-name(.)='Timestamp']\";\n        if (this.hasTimeStamp && !(this.signer.references.filter(function (ref) { return (ref.xpath === timestampXpath); }).length > 0)) {\n            this.signer.addReference(timestampXpath, references);\n        }\n        this.signer.computeSignature(xmlWithSec, this.signerOptions);\n        return insertStr(this.signer.getSignatureXml(), xmlWithSec, xmlWithSec.indexOf('</wsse:Security>'));\n    };\n    return WSSecurityCert;\n}());\nexports.WSSecurityCert = WSSecurityCert;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}