{"ast":null,"code":"\"use strict\";\n/*\n * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>\n * MIT Licensed\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nexports.__esModule = true;\nexports.Client = void 0;\n\nvar assert = require(\"assert\");\n\nvar debugBuilder = require(\"debug\");\n\nvar events_1 = require(\"events\");\n\nvar getStream = require(\"get-stream\");\n\nvar _ = require(\"lodash\");\n\nvar uuid_1 = require(\"uuid\");\n\nvar http_1 = require(\"./http\");\n\nvar utils_1 = require(\"./utils\");\n\nvar debug = debugBuilder('node-soap');\nvar nonIdentifierChars = /[^a-z$_0-9]/i;\n\nvar Client =\n/** @class */\nfunction (_super) {\n  __extends(Client, _super);\n\n  function Client(wsdl, endpoint, options) {\n    var _this_1 = _super.call(this) || this;\n\n    options = options || {};\n    _this_1.wsdl = wsdl;\n\n    _this_1._initializeOptions(options);\n\n    _this_1._initializeServices(endpoint);\n\n    _this_1.httpClient = options.httpClient || new http_1.HttpClient(options);\n    return _this_1;\n  }\n  /** add soapHeader to soap:Header node */\n\n\n  Client.prototype.addSoapHeader = function (soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    return this.soapHeaders.push(soapHeader) - 1;\n  };\n\n  Client.prototype.changeSoapHeader = function (index, soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    this.soapHeaders[index] = soapHeader;\n  };\n  /** return all defined headers */\n\n\n  Client.prototype.getSoapHeaders = function () {\n    return this.soapHeaders;\n  };\n  /** remove all defined headers */\n\n\n  Client.prototype.clearSoapHeaders = function () {\n    this.soapHeaders = null;\n  };\n\n  Client.prototype.addHttpHeader = function (name, value) {\n    if (!this.httpHeaders) {\n      this.httpHeaders = {};\n    }\n\n    this.httpHeaders[name] = value;\n  };\n\n  Client.prototype.getHttpHeaders = function () {\n    return this.httpHeaders;\n  };\n\n  Client.prototype.clearHttpHeaders = function () {\n    this.httpHeaders = null;\n  };\n\n  Client.prototype.addBodyAttribute = function (bodyAttribute, name, namespace, xmlns) {\n    if (!this.bodyAttributes) {\n      this.bodyAttributes = [];\n    }\n\n    if (typeof bodyAttribute === 'object') {\n      var composition_1 = '';\n      Object.getOwnPropertyNames(bodyAttribute).forEach(function (prop, idx, array) {\n        composition_1 += ' ' + prop + '=\"' + bodyAttribute[prop] + '\"';\n      });\n      bodyAttribute = composition_1;\n    }\n\n    if (bodyAttribute.substr(0, 1) !== ' ') {\n      bodyAttribute = ' ' + bodyAttribute;\n    }\n\n    this.bodyAttributes.push(bodyAttribute);\n  };\n\n  Client.prototype.getBodyAttributes = function () {\n    return this.bodyAttributes;\n  };\n\n  Client.prototype.clearBodyAttributes = function () {\n    this.bodyAttributes = null;\n  };\n  /** overwrite the SOAP service endpoint address */\n\n\n  Client.prototype.setEndpoint = function (endpoint) {\n    this.endpoint = endpoint;\n\n    this._initializeServices(endpoint);\n  };\n  /** description of services, ports and methods as a JavaScript object */\n\n\n  Client.prototype.describe = function () {\n    return this.wsdl.describeServices();\n  };\n  /** use the specified security protocol */\n\n\n  Client.prototype.setSecurity = function (security) {\n    this.security = security;\n  };\n\n  Client.prototype.setSOAPAction = function (SOAPAction) {\n    this.SOAPAction = SOAPAction;\n  };\n\n  Client.prototype._initializeServices = function (endpoint) {\n    var definitions = this.wsdl.definitions;\n    var services = definitions.services;\n\n    for (var name_1 in services) {\n      this[name_1] = this._defineService(services[name_1], endpoint);\n    }\n  };\n\n  Client.prototype._initializeOptions = function (options) {\n    this.streamAllowed = options.stream;\n    this.returnSaxStream = options.returnSaxStream;\n    this.normalizeNames = options.normalizeNames;\n    this.overridePromiseSuffix = options.overridePromiseSuffix || 'Async';\n    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n    this.wsdl.options.envelopeKey = options.envelopeKey || 'soap';\n    this.wsdl.options.preserveWhitespace = !!options.preserveWhitespace;\n    var igNs = options.ignoredNamespaces;\n\n    if (igNs !== undefined && typeof igNs === 'object') {\n      if ('override' in igNs) {\n        if (igNs.override === true) {\n          if (igNs.namespaces !== undefined) {\n            this.wsdl.options.ignoredNamespaces = igNs.namespaces;\n          }\n        }\n      }\n    }\n\n    if (options.overrideRootElement !== undefined) {\n      this.wsdl.options.overrideRootElement = options.overrideRootElement;\n    }\n\n    this.wsdl.options.forceSoap12Headers = !!options.forceSoap12Headers;\n  };\n\n  Client.prototype._defineService = function (service, endpoint) {\n    var ports = service.ports;\n    var def = {};\n\n    for (var name_2 in ports) {\n      def[name_2] = this._definePort(ports[name_2], endpoint ? endpoint : ports[name_2].location);\n    }\n\n    return def;\n  };\n\n  Client.prototype._definePort = function (port, endpoint) {\n    var location = endpoint;\n    var binding = port.binding;\n    var methods = binding.methods;\n    var def = {};\n\n    for (var name_3 in methods) {\n      def[name_3] = this._defineMethod(methods[name_3], location);\n      var methodName = this.normalizeNames ? name_3.replace(nonIdentifierChars, '_') : name_3;\n      this[methodName] = def[name_3];\n\n      if (!nonIdentifierChars.test(methodName)) {\n        var suffix = this.overridePromiseSuffix;\n        this[methodName + suffix] = this._promisifyMethod(def[name_3]);\n      }\n    }\n\n    return def;\n  };\n\n  Client.prototype._promisifyMethod = function (method) {\n    return function (args, options, extraHeaders) {\n      return new Promise(function (resolve, reject) {\n        var callback = function (err, result, rawResponse, soapHeader, rawRequest, mtomAttachments) {\n          if (err) {\n            reject(err);\n          } else {\n            resolve([result, rawResponse, soapHeader, rawRequest, mtomAttachments]);\n          }\n        };\n\n        method(args, callback, options, extraHeaders);\n      });\n    };\n  };\n\n  Client.prototype._defineMethod = function (method, location) {\n    var _this_1 = this;\n\n    var temp;\n    return function (args, callback, options, extraHeaders) {\n      if (typeof args === 'function') {\n        callback = args;\n        args = {};\n      } else if (typeof options === 'function') {\n        temp = callback;\n        callback = options;\n        options = temp;\n      } else if (typeof extraHeaders === 'function') {\n        temp = callback;\n        callback = extraHeaders;\n        extraHeaders = options;\n        options = temp;\n      }\n\n      _this_1._invoke(method, args, location, function (error, result, rawResponse, soapHeader, rawRequest, mtomAttachments) {\n        callback(error, result, rawResponse, soapHeader, rawRequest, mtomAttachments);\n      }, options, extraHeaders);\n    };\n  };\n\n  Client.prototype._processSoapHeader = function (soapHeader, name, namespace, xmlns) {\n    switch (typeof soapHeader) {\n      case 'object':\n        return this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);\n\n      case 'function':\n        var _this_2 = this; // arrow function does not support arguments variable\n        // tslint:disable-next-line\n\n\n        return function () {\n          var result = soapHeader.apply(null, arguments);\n\n          if (typeof result === 'object') {\n            return _this_2.wsdl.objectToXML(result, name, namespace, xmlns, true);\n          } else {\n            return result;\n          }\n        };\n\n      default:\n        return soapHeader;\n    }\n  };\n\n  Client.prototype._invoke = function (method, args, location, callback, options, extraHeaders) {\n    var _this_1 = this;\n\n    var name = method.$name;\n    var input = method.input;\n    var output = method.output;\n    var style = method.style;\n    var defs = this.wsdl.definitions;\n    var envelopeKey = this.wsdl.options.envelopeKey;\n    var ns = defs.$targetNamespace;\n    var encoding = '';\n    var message = '';\n    var xml = null;\n    var soapAction;\n    var alias = utils_1.findPrefix(defs.xmlns, ns);\n    var headers = {\n      'Content-Type': 'text/xml; charset=utf-8'\n    };\n    var xmlnsSoap = 'xmlns:' + envelopeKey + '=\"http://schemas.xmlsoap.org/soap/envelope/\"';\n\n    var finish = function (obj, body, response) {\n      var result;\n\n      if (!output) {\n        // one-way, no output expected\n        return callback(null, null, body, obj.Header, xml, response.mtomResponseAttachments);\n      } // If it's not HTML and Soap Body is empty\n\n\n      if (!obj.html && !obj.Body) {\n        if (response.status >= 400) {\n          var error = new Error('Error http status codes');\n          error.response = response;\n          error.body = body;\n\n          _this_1.emit('soapError', error, eid);\n\n          return callback(error, obj, body, obj.Header);\n        }\n\n        return callback(null, obj, body, obj.Header);\n      }\n\n      if (typeof obj.Body !== 'object') {\n        var error = new Error('Cannot parse response');\n        error.response = response;\n        error.body = body;\n        return callback(error, obj, body, undefined, xml);\n      }\n\n      result = obj.Body[output.$name]; // RPC/literal response body may contain elements with added suffixes I.E.\n      // 'Response', or 'Output', or 'Out'\n      // This doesn't necessarily equal the ouput message name. See WSDL 1.1 Section 2.4.5\n\n      if (!result) {\n        result = obj.Body[output.$name.replace(/(?:Out(?:put)?|Response)$/, '')];\n      }\n\n      if (!result) {\n        ['Response', 'Out', 'Output'].forEach(function (term) {\n          if (obj.Body.hasOwnProperty(name + term)) {\n            return result = obj.Body[name + term];\n          }\n        });\n      }\n\n      callback(null, result, body, obj.Header, xml, response.mtomResponseAttachments);\n    };\n\n    var parseSync = function (body, response) {\n      var obj;\n\n      try {\n        obj = _this_1.wsdl.xmlToObject(body);\n      } catch (error) {\n        //  When the output element cannot be looked up in the wsdl and the body is JSON\n        //  instead of sending the error, we pass the body in the response.\n        if (!output || !output.$lookupTypes) {\n          debug('Response element is not present. Unable to convert response xml to json.'); //  If the response is JSON then return it as-is.\n\n          var json = _.isObject(body) ? body : tryJSONparse(body);\n\n          if (json) {\n            return callback(null, response, json, undefined, xml);\n          }\n        }\n\n        error.response = response;\n        error.body = body;\n\n        _this_1.emit('soapError', error, eid);\n\n        return callback(error, response, body, undefined, xml, response.mtomResponseAttachments);\n      }\n\n      return finish(obj, body, response);\n    };\n\n    if (this.SOAPAction) {\n      soapAction = this.SOAPAction;\n    } else if (method.soapAction !== undefined && method.soapAction !== null) {\n      soapAction = method.soapAction;\n    } else {\n      soapAction = (ns.lastIndexOf('/') !== ns.length - 1 ? ns + '/' : ns) + name;\n    }\n\n    if (this.wsdl.options.forceSoap12Headers) {\n      headers['Content-Type'] = \"application/soap+xml; charset=utf-8; action=\\\"\" + soapAction + \"\\\"\";\n      xmlnsSoap = 'xmlns:' + envelopeKey + '=\"http://www.w3.org/2003/05/soap-envelope\"';\n    } else {\n      headers.SOAPAction = '\"' + soapAction + '\"';\n    }\n\n    options = options || {}; // Add extra headers\n\n    if (this.httpHeaders === null) {\n      headers = {};\n    } else {\n      for (var header in this.httpHeaders) {\n        headers[header] = this.httpHeaders[header];\n      }\n\n      for (var attr in extraHeaders) {\n        headers[attr] = extraHeaders[attr];\n      }\n    } // Allow the security object to add headers\n\n\n    if (this.security && this.security.addHeaders) {\n      this.security.addHeaders(headers);\n    }\n\n    if (this.security && this.security.addOptions) {\n      this.security.addOptions(options);\n    }\n\n    if (style === 'rpc' && (input.parts || input.name === 'element' || args === null)) {\n      assert.ok(!style || style === 'rpc', 'invalid message definition for document style binding');\n      message = this.wsdl.objectToRpcXML(name, args, alias, ns, input.name !== 'element');\n      method.inputSoap === 'encoded' && (encoding = 'soap:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" ');\n    } else {\n      assert.ok(!style || style === 'document', 'invalid message definition for rpc style binding'); // pass `input.$lookupType` if `input.$type` could not be found\n\n      message = this.wsdl.objectToDocumentXML(input.$name, args, input.targetNSAlias, input.targetNamespace, input.$type || input.$lookupType);\n    }\n\n    var decodedHeaders;\n\n    if (this.soapHeaders) {\n      decodedHeaders = this.soapHeaders.map(function (header) {\n        if (typeof header === 'function') {\n          return header(method, location, soapAction, args);\n        } else {\n          return header;\n        }\n      }).join(' ');\n    }\n\n    xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>' + '<' + envelopeKey + ':Envelope ' + xmlnsSoap + ' ' + 'xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ' + encoding + this.wsdl.xmlnsInEnvelope + '>' + (decodedHeaders || this.security ? '<' + envelopeKey + ':Header' + (this.wsdl.xmlnsInHeader ? ' ' + this.wsdl.xmlnsInHeader : '') + '>' + (decodedHeaders ? decodedHeaders : '') + (this.security && !this.security.postProcess ? this.security.toXML() : '') + '</' + envelopeKey + ':Header>' : '') + '<' + envelopeKey + ':Body' + (this.bodyAttributes ? this.bodyAttributes.join(' ') : '') + (this.security && this.security.postProcess ? ' Id=\"_0\"' : '') + '>' + message + '</' + envelopeKey + ':Body>' + '</' + envelopeKey + ':Envelope>';\n\n    if (this.security && this.security.postProcess) {\n      xml = this.security.postProcess(xml, envelopeKey);\n    }\n\n    if (options && options.postProcess) {\n      xml = options.postProcess(xml);\n    }\n\n    this.lastMessage = message;\n    this.lastRequest = xml;\n    this.lastEndpoint = location;\n    var eid = options.exchangeId || uuid_1.v4();\n    this.emit('message', message, eid);\n    this.emit('request', xml, eid);\n\n    var tryJSONparse = function (body) {\n      try {\n        return JSON.parse(body);\n      } catch (err) {\n        return undefined;\n      }\n    };\n\n    if (this.streamAllowed && typeof this.httpClient.requestStream === 'function') {\n      callback = _.once(callback);\n      var startTime_1 = Date.now();\n\n      var onError_1 = function (err) {\n        _this_1.lastResponse = null;\n        _this_1.lastResponseHeaders = null;\n        _this_1.lastElapsedTime = null;\n        _this_1.lastRequestHeaders = err.config && err.config.headers;\n\n        _this_1.emit('response', null, null, eid);\n\n        if (_this_1.returnSaxStream || !err.response || !err.response.data) {\n          callback(err, undefined, undefined, undefined, xml);\n        } else {\n          err.response.data.on('close', function (e) {\n            callback(err, undefined, undefined, undefined, xml);\n          });\n          err.response.data.on('data', function (e) {\n            err.response.data = e.toString();\n          });\n        }\n      };\n\n      this.httpClient.requestStream(location, xml, headers, options, this).then(function (res) {\n        _this_1.lastRequestHeaders = res.headers;\n\n        if (res.data.on) {\n          res.data.on('error', function (err) {\n            return onError_1(err);\n          });\n        } // When the output element cannot be looked up in the wsdl,\n        // play it safe and don't stream\n\n\n        if (res.status !== 200 || !output || !output.$lookupTypes) {\n          getStream(res.data).then(function (body) {\n            _this_1.lastResponse = body;\n            _this_1.lastElapsedTime = Date.now() - startTime_1;\n            _this_1.lastResponseHeaders = res && res.headers; // Added mostly for testability, but possibly useful for debugging\n\n            _this_1.lastRequestHeaders = res.config && res.config.headers || res.headers;\n\n            _this_1.emit('response', body, res, eid);\n\n            return parseSync(body, res);\n          });\n          return;\n        }\n\n        if (_this_1.returnSaxStream) {\n          // directly return the saxStream allowing the end user to define\n          // the parsing logics and corresponding errors managements\n          var saxStream = _this_1.wsdl.getSaxStream(res.data);\n\n          return finish({\n            saxStream: saxStream\n          }, '<stream>', res.data);\n        } else {\n          _this_1.wsdl.xmlToObject(res.data, function (error, obj) {\n            _this_1.lastResponse = res;\n            _this_1.lastElapsedTime = Date.now() - startTime_1;\n            _this_1.lastResponseHeaders = res && res.headers; // Added mostly for testability, but possibly useful for debugging\n\n            _this_1.lastRequestHeaders = res.config.headers;\n\n            _this_1.emit('response', '<stream>', res.data, eid);\n\n            if (error) {\n              error.response = res;\n              error.body = '<stream>';\n\n              _this_1.emit('soapError', error, eid);\n\n              return callback(error, res, undefined, undefined, xml);\n            }\n\n            return finish(obj, '<stream>', res);\n          });\n        }\n      }, onError_1);\n      return;\n    }\n\n    var startTime = Date.now();\n    return this.httpClient.request(location, xml, function (err, response, body) {\n      _this_1.lastResponse = body;\n\n      if (response) {\n        _this_1.lastResponseHeaders = response.headers;\n        _this_1.lastElapsedTime = Date.now() - startTime;\n        _this_1.lastResponseAttachments = response.mtomResponseAttachments; // Added mostly for testability, but possibly useful for debugging\n\n        _this_1.lastRequestHeaders = response.config && response.config.headers;\n      }\n\n      _this_1.emit('response', body, response, eid);\n\n      if (err) {\n        _this_1.lastRequestHeaders = err.config && err.config.headers;\n\n        try {\n          if (err.response && err.response.data) {\n            _this_1.wsdl.xmlToObject(err.response.data);\n          }\n        } catch (error) {\n          err.root = error.root || error;\n        }\n\n        callback(err, undefined, undefined, undefined, xml);\n      } else {\n        return parseSync(body, response);\n      }\n    }, headers, options, this);\n  };\n\n  return Client;\n}(events_1.EventEmitter);\n\nexports.Client = Client;","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","exports","__esModule","Client","assert","require","debugBuilder","events_1","getStream","_","uuid_1","http_1","utils_1","debug","nonIdentifierChars","_super","wsdl","endpoint","options","_this_1","call","_initializeOptions","_initializeServices","httpClient","HttpClient","addSoapHeader","soapHeader","name","namespace","xmlns","soapHeaders","_processSoapHeader","push","changeSoapHeader","index","getSoapHeaders","clearSoapHeaders","addHttpHeader","value","httpHeaders","getHttpHeaders","clearHttpHeaders","addBodyAttribute","bodyAttribute","bodyAttributes","composition_1","getOwnPropertyNames","forEach","prop","idx","array","substr","getBodyAttributes","clearBodyAttributes","setEndpoint","describe","describeServices","setSecurity","security","setSOAPAction","SOAPAction","definitions","services","name_1","_defineService","streamAllowed","stream","returnSaxStream","normalizeNames","overridePromiseSuffix","attributesKey","envelopeKey","preserveWhitespace","igNs","ignoredNamespaces","undefined","override","namespaces","overrideRootElement","forceSoap12Headers","service","ports","def","name_2","_definePort","location","port","binding","methods","name_3","_defineMethod","methodName","replace","test","suffix","_promisifyMethod","method","args","extraHeaders","Promise","resolve","reject","callback","err","result","rawResponse","rawRequest","mtomAttachments","temp","_invoke","error","objectToXML","_this_2","apply","arguments","$name","input","output","style","defs","ns","$targetNamespace","encoding","message","xml","soapAction","alias","findPrefix","headers","xmlnsSoap","finish","obj","body","response","Header","mtomResponseAttachments","html","Body","status","Error","emit","eid","term","parseSync","xmlToObject","$lookupTypes","json","isObject","tryJSONparse","lastIndexOf","length","header","attr","addHeaders","addOptions","parts","ok","objectToRpcXML","inputSoap","objectToDocumentXML","targetNSAlias","targetNamespace","$type","$lookupType","decodedHeaders","map","join","xmlnsInEnvelope","xmlnsInHeader","postProcess","toXML","lastMessage","lastRequest","lastEndpoint","exchangeId","v4","JSON","parse","requestStream","once","startTime_1","Date","now","onError_1","lastResponse","lastResponseHeaders","lastElapsedTime","lastRequestHeaders","config","data","on","e","toString","then","res","saxStream","getSaxStream","startTime","request","lastResponseAttachments","root","EventEmitter"],"sources":["C:/Users/ayber/node_modules/soap/lib/client.js"],"sourcesContent":["\"use strict\";\n/*\n * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>\n * MIT Licensed\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nexports.__esModule = true;\nexports.Client = void 0;\nvar assert = require(\"assert\");\nvar debugBuilder = require(\"debug\");\nvar events_1 = require(\"events\");\nvar getStream = require(\"get-stream\");\nvar _ = require(\"lodash\");\nvar uuid_1 = require(\"uuid\");\nvar http_1 = require(\"./http\");\nvar utils_1 = require(\"./utils\");\nvar debug = debugBuilder('node-soap');\nvar nonIdentifierChars = /[^a-z$_0-9]/i;\nvar Client = /** @class */ (function (_super) {\n    __extends(Client, _super);\n    function Client(wsdl, endpoint, options) {\n        var _this_1 = _super.call(this) || this;\n        options = options || {};\n        _this_1.wsdl = wsdl;\n        _this_1._initializeOptions(options);\n        _this_1._initializeServices(endpoint);\n        _this_1.httpClient = options.httpClient || new http_1.HttpClient(options);\n        return _this_1;\n    }\n    /** add soapHeader to soap:Header node */\n    Client.prototype.addSoapHeader = function (soapHeader, name, namespace, xmlns) {\n        if (!this.soapHeaders) {\n            this.soapHeaders = [];\n        }\n        soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n        return this.soapHeaders.push(soapHeader) - 1;\n    };\n    Client.prototype.changeSoapHeader = function (index, soapHeader, name, namespace, xmlns) {\n        if (!this.soapHeaders) {\n            this.soapHeaders = [];\n        }\n        soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n        this.soapHeaders[index] = soapHeader;\n    };\n    /** return all defined headers */\n    Client.prototype.getSoapHeaders = function () {\n        return this.soapHeaders;\n    };\n    /** remove all defined headers */\n    Client.prototype.clearSoapHeaders = function () {\n        this.soapHeaders = null;\n    };\n    Client.prototype.addHttpHeader = function (name, value) {\n        if (!this.httpHeaders) {\n            this.httpHeaders = {};\n        }\n        this.httpHeaders[name] = value;\n    };\n    Client.prototype.getHttpHeaders = function () {\n        return this.httpHeaders;\n    };\n    Client.prototype.clearHttpHeaders = function () {\n        this.httpHeaders = null;\n    };\n    Client.prototype.addBodyAttribute = function (bodyAttribute, name, namespace, xmlns) {\n        if (!this.bodyAttributes) {\n            this.bodyAttributes = [];\n        }\n        if (typeof bodyAttribute === 'object') {\n            var composition_1 = '';\n            Object.getOwnPropertyNames(bodyAttribute).forEach(function (prop, idx, array) {\n                composition_1 += ' ' + prop + '=\"' + bodyAttribute[prop] + '\"';\n            });\n            bodyAttribute = composition_1;\n        }\n        if (bodyAttribute.substr(0, 1) !== ' ') {\n            bodyAttribute = ' ' + bodyAttribute;\n        }\n        this.bodyAttributes.push(bodyAttribute);\n    };\n    Client.prototype.getBodyAttributes = function () {\n        return this.bodyAttributes;\n    };\n    Client.prototype.clearBodyAttributes = function () {\n        this.bodyAttributes = null;\n    };\n    /** overwrite the SOAP service endpoint address */\n    Client.prototype.setEndpoint = function (endpoint) {\n        this.endpoint = endpoint;\n        this._initializeServices(endpoint);\n    };\n    /** description of services, ports and methods as a JavaScript object */\n    Client.prototype.describe = function () {\n        return this.wsdl.describeServices();\n    };\n    /** use the specified security protocol */\n    Client.prototype.setSecurity = function (security) {\n        this.security = security;\n    };\n    Client.prototype.setSOAPAction = function (SOAPAction) {\n        this.SOAPAction = SOAPAction;\n    };\n    Client.prototype._initializeServices = function (endpoint) {\n        var definitions = this.wsdl.definitions;\n        var services = definitions.services;\n        for (var name_1 in services) {\n            this[name_1] = this._defineService(services[name_1], endpoint);\n        }\n    };\n    Client.prototype._initializeOptions = function (options) {\n        this.streamAllowed = options.stream;\n        this.returnSaxStream = options.returnSaxStream;\n        this.normalizeNames = options.normalizeNames;\n        this.overridePromiseSuffix = options.overridePromiseSuffix || 'Async';\n        this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n        this.wsdl.options.envelopeKey = options.envelopeKey || 'soap';\n        this.wsdl.options.preserveWhitespace = !!options.preserveWhitespace;\n        var igNs = options.ignoredNamespaces;\n        if (igNs !== undefined && typeof igNs === 'object') {\n            if ('override' in igNs) {\n                if (igNs.override === true) {\n                    if (igNs.namespaces !== undefined) {\n                        this.wsdl.options.ignoredNamespaces = igNs.namespaces;\n                    }\n                }\n            }\n        }\n        if (options.overrideRootElement !== undefined) {\n            this.wsdl.options.overrideRootElement = options.overrideRootElement;\n        }\n        this.wsdl.options.forceSoap12Headers = !!options.forceSoap12Headers;\n    };\n    Client.prototype._defineService = function (service, endpoint) {\n        var ports = service.ports;\n        var def = {};\n        for (var name_2 in ports) {\n            def[name_2] = this._definePort(ports[name_2], endpoint ? endpoint : ports[name_2].location);\n        }\n        return def;\n    };\n    Client.prototype._definePort = function (port, endpoint) {\n        var location = endpoint;\n        var binding = port.binding;\n        var methods = binding.methods;\n        var def = {};\n        for (var name_3 in methods) {\n            def[name_3] = this._defineMethod(methods[name_3], location);\n            var methodName = this.normalizeNames ? name_3.replace(nonIdentifierChars, '_') : name_3;\n            this[methodName] = def[name_3];\n            if (!nonIdentifierChars.test(methodName)) {\n                var suffix = this.overridePromiseSuffix;\n                this[methodName + suffix] = this._promisifyMethod(def[name_3]);\n            }\n        }\n        return def;\n    };\n    Client.prototype._promisifyMethod = function (method) {\n        return function (args, options, extraHeaders) {\n            return new Promise(function (resolve, reject) {\n                var callback = function (err, result, rawResponse, soapHeader, rawRequest, mtomAttachments) {\n                    if (err) {\n                        reject(err);\n                    }\n                    else {\n                        resolve([result, rawResponse, soapHeader, rawRequest, mtomAttachments]);\n                    }\n                };\n                method(args, callback, options, extraHeaders);\n            });\n        };\n    };\n    Client.prototype._defineMethod = function (method, location) {\n        var _this_1 = this;\n        var temp;\n        return function (args, callback, options, extraHeaders) {\n            if (typeof args === 'function') {\n                callback = args;\n                args = {};\n            }\n            else if (typeof options === 'function') {\n                temp = callback;\n                callback = options;\n                options = temp;\n            }\n            else if (typeof extraHeaders === 'function') {\n                temp = callback;\n                callback = extraHeaders;\n                extraHeaders = options;\n                options = temp;\n            }\n            _this_1._invoke(method, args, location, function (error, result, rawResponse, soapHeader, rawRequest, mtomAttachments) {\n                callback(error, result, rawResponse, soapHeader, rawRequest, mtomAttachments);\n            }, options, extraHeaders);\n        };\n    };\n    Client.prototype._processSoapHeader = function (soapHeader, name, namespace, xmlns) {\n        switch (typeof soapHeader) {\n            case 'object':\n                return this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);\n            case 'function':\n                var _this_2 = this;\n                // arrow function does not support arguments variable\n                // tslint:disable-next-line\n                return function () {\n                    var result = soapHeader.apply(null, arguments);\n                    if (typeof result === 'object') {\n                        return _this_2.wsdl.objectToXML(result, name, namespace, xmlns, true);\n                    }\n                    else {\n                        return result;\n                    }\n                };\n            default:\n                return soapHeader;\n        }\n    };\n    Client.prototype._invoke = function (method, args, location, callback, options, extraHeaders) {\n        var _this_1 = this;\n        var name = method.$name;\n        var input = method.input;\n        var output = method.output;\n        var style = method.style;\n        var defs = this.wsdl.definitions;\n        var envelopeKey = this.wsdl.options.envelopeKey;\n        var ns = defs.$targetNamespace;\n        var encoding = '';\n        var message = '';\n        var xml = null;\n        var soapAction;\n        var alias = utils_1.findPrefix(defs.xmlns, ns);\n        var headers = {\n            'Content-Type': 'text/xml; charset=utf-8'\n        };\n        var xmlnsSoap = 'xmlns:' + envelopeKey + '=\"http://schemas.xmlsoap.org/soap/envelope/\"';\n        var finish = function (obj, body, response) {\n            var result;\n            if (!output) {\n                // one-way, no output expected\n                return callback(null, null, body, obj.Header, xml, response.mtomResponseAttachments);\n            }\n            // If it's not HTML and Soap Body is empty\n            if (!obj.html && !obj.Body) {\n                if (response.status >= 400) {\n                    var error = new Error('Error http status codes');\n                    error.response = response;\n                    error.body = body;\n                    _this_1.emit('soapError', error, eid);\n                    return callback(error, obj, body, obj.Header);\n                }\n                return callback(null, obj, body, obj.Header);\n            }\n            if (typeof obj.Body !== 'object') {\n                var error = new Error('Cannot parse response');\n                error.response = response;\n                error.body = body;\n                return callback(error, obj, body, undefined, xml);\n            }\n            result = obj.Body[output.$name];\n            // RPC/literal response body may contain elements with added suffixes I.E.\n            // 'Response', or 'Output', or 'Out'\n            // This doesn't necessarily equal the ouput message name. See WSDL 1.1 Section 2.4.5\n            if (!result) {\n                result = obj.Body[output.$name.replace(/(?:Out(?:put)?|Response)$/, '')];\n            }\n            if (!result) {\n                ['Response', 'Out', 'Output'].forEach(function (term) {\n                    if (obj.Body.hasOwnProperty(name + term)) {\n                        return result = obj.Body[name + term];\n                    }\n                });\n            }\n            callback(null, result, body, obj.Header, xml, response.mtomResponseAttachments);\n        };\n        var parseSync = function (body, response) {\n            var obj;\n            try {\n                obj = _this_1.wsdl.xmlToObject(body);\n            }\n            catch (error) {\n                //  When the output element cannot be looked up in the wsdl and the body is JSON\n                //  instead of sending the error, we pass the body in the response.\n                if (!output || !output.$lookupTypes) {\n                    debug('Response element is not present. Unable to convert response xml to json.');\n                    //  If the response is JSON then return it as-is.\n                    var json = _.isObject(body) ? body : tryJSONparse(body);\n                    if (json) {\n                        return callback(null, response, json, undefined, xml);\n                    }\n                }\n                error.response = response;\n                error.body = body;\n                _this_1.emit('soapError', error, eid);\n                return callback(error, response, body, undefined, xml, response.mtomResponseAttachments);\n            }\n            return finish(obj, body, response);\n        };\n        if (this.SOAPAction) {\n            soapAction = this.SOAPAction;\n        }\n        else if (method.soapAction !== undefined && method.soapAction !== null) {\n            soapAction = method.soapAction;\n        }\n        else {\n            soapAction = ((ns.lastIndexOf('/') !== ns.length - 1) ? ns + '/' : ns) + name;\n        }\n        if (this.wsdl.options.forceSoap12Headers) {\n            headers['Content-Type'] = \"application/soap+xml; charset=utf-8; action=\\\"\" + soapAction + \"\\\"\";\n            xmlnsSoap = 'xmlns:' + envelopeKey + '=\"http://www.w3.org/2003/05/soap-envelope\"';\n        }\n        else {\n            headers.SOAPAction = '\"' + soapAction + '\"';\n        }\n        options = options || {};\n        // Add extra headers\n        if (this.httpHeaders === null) {\n            headers = {};\n        }\n        else {\n            for (var header in this.httpHeaders) {\n                headers[header] = this.httpHeaders[header];\n            }\n            for (var attr in extraHeaders) {\n                headers[attr] = extraHeaders[attr];\n            }\n        }\n        // Allow the security object to add headers\n        if (this.security && this.security.addHeaders) {\n            this.security.addHeaders(headers);\n        }\n        if (this.security && this.security.addOptions) {\n            this.security.addOptions(options);\n        }\n        if ((style === 'rpc') && ((input.parts || input.name === 'element') || args === null)) {\n            assert.ok(!style || style === 'rpc', 'invalid message definition for document style binding');\n            message = this.wsdl.objectToRpcXML(name, args, alias, ns, (input.name !== 'element'));\n            (method.inputSoap === 'encoded') && (encoding = 'soap:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" ');\n        }\n        else {\n            assert.ok(!style || style === 'document', 'invalid message definition for rpc style binding');\n            // pass `input.$lookupType` if `input.$type` could not be found\n            message = this.wsdl.objectToDocumentXML(input.$name, args, input.targetNSAlias, input.targetNamespace, (input.$type || input.$lookupType));\n        }\n        var decodedHeaders;\n        if (this.soapHeaders) {\n            decodedHeaders = this.soapHeaders.map(function (header) {\n                if (typeof header === 'function') {\n                    return header(method, location, soapAction, args);\n                }\n                else {\n                    return header;\n                }\n            }).join(' ');\n        }\n        xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>' +\n            '<' + envelopeKey + ':Envelope ' +\n            xmlnsSoap + ' ' +\n            'xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ' +\n            encoding +\n            this.wsdl.xmlnsInEnvelope + '>' +\n            ((decodedHeaders || this.security) ?\n                ('<' + envelopeKey + ':Header' + (this.wsdl.xmlnsInHeader ? (' ' + this.wsdl.xmlnsInHeader) : '') + '>' +\n                    (decodedHeaders ? decodedHeaders : '') +\n                    (this.security && !this.security.postProcess ? this.security.toXML() : '') +\n                    '</' + envelopeKey + ':Header>')\n                :\n                    '') +\n            '<' + envelopeKey + ':Body' +\n            (this.bodyAttributes ? this.bodyAttributes.join(' ') : '') +\n            (this.security && this.security.postProcess ? ' Id=\"_0\"' : '') +\n            '>' +\n            message +\n            '</' + envelopeKey + ':Body>' +\n            '</' + envelopeKey + ':Envelope>';\n        if (this.security && this.security.postProcess) {\n            xml = this.security.postProcess(xml, envelopeKey);\n        }\n        if (options && options.postProcess) {\n            xml = options.postProcess(xml);\n        }\n        this.lastMessage = message;\n        this.lastRequest = xml;\n        this.lastEndpoint = location;\n        var eid = options.exchangeId || uuid_1.v4();\n        this.emit('message', message, eid);\n        this.emit('request', xml, eid);\n        var tryJSONparse = function (body) {\n            try {\n                return JSON.parse(body);\n            }\n            catch (err) {\n                return undefined;\n            }\n        };\n        if (this.streamAllowed && typeof this.httpClient.requestStream === 'function') {\n            callback = _.once(callback);\n            var startTime_1 = Date.now();\n            var onError_1 = function (err) {\n                _this_1.lastResponse = null;\n                _this_1.lastResponseHeaders = null;\n                _this_1.lastElapsedTime = null;\n                _this_1.lastRequestHeaders = err.config && err.config.headers;\n                _this_1.emit('response', null, null, eid);\n                if (_this_1.returnSaxStream || !err.response || !err.response.data) {\n                    callback(err, undefined, undefined, undefined, xml);\n                }\n                else {\n                    err.response.data.on('close', function (e) {\n                        callback(err, undefined, undefined, undefined, xml);\n                    });\n                    err.response.data.on('data', function (e) {\n                        err.response.data = e.toString();\n                    });\n                }\n            };\n            this.httpClient.requestStream(location, xml, headers, options, this).then(function (res) {\n                _this_1.lastRequestHeaders = res.headers;\n                if (res.data.on) {\n                    res.data.on('error', function (err) { return onError_1(err); });\n                }\n                // When the output element cannot be looked up in the wsdl,\n                // play it safe and don't stream\n                if (res.status !== 200 || !output || !output.$lookupTypes) {\n                    getStream(res.data).then(function (body) {\n                        _this_1.lastResponse = body;\n                        _this_1.lastElapsedTime = Date.now() - startTime_1;\n                        _this_1.lastResponseHeaders = res && res.headers;\n                        // Added mostly for testability, but possibly useful for debugging\n                        _this_1.lastRequestHeaders = res.config && res.config.headers || res.headers;\n                        _this_1.emit('response', body, res, eid);\n                        return parseSync(body, res);\n                    });\n                    return;\n                }\n                if (_this_1.returnSaxStream) {\n                    // directly return the saxStream allowing the end user to define\n                    // the parsing logics and corresponding errors managements\n                    var saxStream = _this_1.wsdl.getSaxStream(res.data);\n                    return finish({ saxStream: saxStream }, '<stream>', res.data);\n                }\n                else {\n                    _this_1.wsdl.xmlToObject(res.data, function (error, obj) {\n                        _this_1.lastResponse = res;\n                        _this_1.lastElapsedTime = Date.now() - startTime_1;\n                        _this_1.lastResponseHeaders = res && res.headers;\n                        // Added mostly for testability, but possibly useful for debugging\n                        _this_1.lastRequestHeaders = res.config.headers;\n                        _this_1.emit('response', '<stream>', res.data, eid);\n                        if (error) {\n                            error.response = res;\n                            error.body = '<stream>';\n                            _this_1.emit('soapError', error, eid);\n                            return callback(error, res, undefined, undefined, xml);\n                        }\n                        return finish(obj, '<stream>', res);\n                    });\n                }\n            }, onError_1);\n            return;\n        }\n        var startTime = Date.now();\n        return this.httpClient.request(location, xml, function (err, response, body) {\n            _this_1.lastResponse = body;\n            if (response) {\n                _this_1.lastResponseHeaders = response.headers;\n                _this_1.lastElapsedTime = Date.now() - startTime;\n                _this_1.lastResponseAttachments = response.mtomResponseAttachments;\n                // Added mostly for testability, but possibly useful for debugging\n                _this_1.lastRequestHeaders = response.config && response.config.headers;\n            }\n            _this_1.emit('response', body, response, eid);\n            if (err) {\n                _this_1.lastRequestHeaders = err.config && err.config.headers;\n                try {\n                    if (err.response && err.response.data) {\n                        _this_1.wsdl.xmlToObject(err.response.data);\n                    }\n                }\n                catch (error) {\n                    err.root = error.root || error;\n                }\n                callback(err, undefined, undefined, undefined, xml);\n            }\n            else {\n                return parseSync(body, response);\n            }\n        }, headers, options, this);\n    };\n    return Client;\n}(events_1.EventEmitter));\nexports.Client = Client;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}