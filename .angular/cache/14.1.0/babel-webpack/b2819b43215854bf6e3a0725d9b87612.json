{"ast":null,"code":"\"use strict\";\n/*\n * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>\n * MIT Licensed\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nexports.__esModule = true;\nexports.Server = void 0;\n\nvar events_1 = require(\"events\");\n\nvar url = require(\"url\");\n\nvar utils_1 = require(\"./utils\");\n\nvar zlib;\n\ntry {\n  zlib = require('zlib');\n} catch (error) {}\n\nfunction isExpress(server) {\n  return typeof server.route === 'function' && typeof server.use === 'function';\n}\n\nfunction isPromiseLike(obj) {\n  return !!obj && typeof obj.then === 'function';\n}\n\nfunction getDateString(d) {\n  function pad(n) {\n    return n < 10 ? '0' + n : n;\n  }\n\n  return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) + 'Z';\n}\n\nvar Server =\n/** @class */\nfunction (_super) {\n  __extends(Server, _super);\n\n  function Server(server, path, services, wsdl, options) {\n    var _this_1 = _super.call(this) || this;\n\n    options = options || {\n      path: path,\n      services: services\n    };\n    _this_1.path = path;\n    _this_1.services = services;\n    _this_1.wsdl = wsdl;\n    _this_1.suppressStack = options && options.suppressStack;\n    _this_1.returnFault = options && options.returnFault;\n    _this_1.onewayOptions = options && options.oneWay || {};\n    _this_1.enableChunkedEncoding = options.enableChunkedEncoding === undefined ? true : !!options.enableChunkedEncoding;\n    _this_1.callback = options.callback ? options.callback : function () {};\n\n    if (typeof path === 'string' && path[path.length - 1] !== '/') {\n      path += '/';\n    } else if (path instanceof RegExp && path.source[path.source.length - 1] !== '/') {\n      path = new RegExp(path.source + '(?:\\\\/|)');\n    }\n\n    wsdl.onReady(function (err) {\n      if (isExpress(server)) {\n        // handle only the required URL path for express server\n        server.route(path).all(function (req, res) {\n          if (typeof _this_1.authorizeConnection === 'function') {\n            if (!_this_1.authorizeConnection(req, res)) {\n              res.end();\n              return;\n            }\n          }\n\n          _this_1._requestListener(req, res);\n        });\n\n        _this_1.callback(err, _this_1);\n      } else {\n        var listeners_1 = server.listeners('request').slice();\n        server.removeAllListeners('request');\n        server.addListener('request', function (req, res) {\n          if (typeof _this_1.authorizeConnection === 'function') {\n            if (!_this_1.authorizeConnection(req, res)) {\n              res.end();\n              return;\n            }\n          }\n\n          var reqPath = url.parse(req.url).pathname;\n\n          if (reqPath[reqPath.length - 1] !== '/') {\n            reqPath += '/';\n          }\n\n          if (path === reqPath || path instanceof RegExp && reqPath.match(path)) {\n            _this_1._requestListener(req, res);\n          } else {\n            for (var i = 0, len = listeners_1.length; i < len; i++) {\n              listeners_1[i].call(_this_1, req, res);\n            }\n          }\n        });\n\n        _this_1.callback(err, _this_1);\n      }\n    });\n\n    _this_1._initializeOptions(options);\n\n    return _this_1;\n  }\n\n  Server.prototype.addSoapHeader = function (soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    return this.soapHeaders.push(soapHeader) - 1;\n  };\n\n  Server.prototype.changeSoapHeader = function (index, soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    this.soapHeaders[index] = soapHeader;\n  };\n\n  Server.prototype.getSoapHeaders = function () {\n    return this.soapHeaders;\n  };\n\n  Server.prototype.clearSoapHeaders = function () {\n    this.soapHeaders = null;\n  };\n\n  Server.prototype._processSoapHeader = function (soapHeader, name, namespace, xmlns) {\n    switch (typeof soapHeader) {\n      case 'object':\n        return this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);\n\n      case 'function':\n        var _this_2 = this; // arrow function does not support arguments variable\n        // tslint:disable-next-line\n\n\n        return function () {\n          var result = soapHeader.apply(null, arguments);\n\n          if (typeof result === 'object') {\n            return _this_2.wsdl.objectToXML(result, name, namespace, xmlns, true);\n          } else {\n            return result;\n          }\n        };\n\n      default:\n        return soapHeader;\n    }\n  };\n\n  Server.prototype._initializeOptions = function (options) {\n    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n    this.onewayOptions.statusCode = this.onewayOptions.responseCode || 200;\n    this.onewayOptions.emptyBody = !!this.onewayOptions.emptyBody;\n  };\n\n  Server.prototype._processRequestXml = function (req, res, xml) {\n    var _this_1 = this;\n\n    var error;\n\n    try {\n      if (typeof this.log === 'function') {\n        this.log('received', xml);\n      }\n\n      this._process(xml, req, res, function (result, statusCode) {\n        _this_1._sendHttpResponse(res, statusCode, result);\n\n        if (typeof _this_1.log === 'function') {\n          _this_1.log('replied', result);\n        }\n      });\n    } catch (err) {\n      if (err.Fault !== undefined) {\n        return this._sendError(err.Fault, function (result, statusCode) {\n          _this_1._sendHttpResponse(res, statusCode || 500, result);\n\n          if (typeof _this_1.log === 'function') {\n            _this_1.log('error', err);\n          }\n        }, new Date().toISOString());\n      } else {\n        error = err.stack ? this.suppressStack === true ? err.message : err.stack : err;\n\n        this._sendHttpResponse(res,\n        /* statusCode */\n        500, error);\n\n        if (typeof this.log === 'function') {\n          this.log('error', error);\n        }\n      }\n    }\n  };\n\n  Server.prototype._requestListener = function (req, res) {\n    var _this_1 = this;\n\n    var reqParse = url.parse(req.url);\n    var reqPath = reqParse.pathname;\n    var reqQuery = reqParse.search;\n\n    if (typeof this.log === 'function') {\n      this.log('info', 'Handling ' + req.method + ' on ' + req.url);\n    }\n\n    if (req.method === 'GET') {\n      if (reqQuery && reqQuery.toLowerCase().startsWith('?wsdl')) {\n        if (typeof this.log === 'function') {\n          this.log('info', 'Wants the WSDL');\n        }\n\n        res.setHeader('Content-Type', 'application/xml');\n        res.write(this.wsdl.toXML());\n      }\n\n      res.end();\n    } else if (req.method === 'POST') {\n      if (typeof req.headers['content-type'] !== 'undefined') {\n        res.setHeader('Content-Type', req.headers['content-type']);\n      } else {\n        res.setHeader('Content-Type', 'application/xml');\n      } // request body is already provided by an express middleware\n      // in this case unzipping should also be done by the express middleware itself\n\n\n      if (req.body && req.body.length > 0) {\n        return this._processRequestXml(req, res, req.body.toString());\n      }\n\n      var chunks_1 = [];\n      var gunzip = void 0;\n      var source = req;\n\n      if (req.headers['content-encoding'] === 'gzip') {\n        gunzip = zlib.createGunzip();\n        req.pipe(gunzip);\n        source = gunzip;\n      }\n\n      source.on('data', function (chunk) {\n        chunks_1.push(chunk);\n      });\n      source.on('end', function () {\n        var xml = Buffer.concat(chunks_1).toString();\n\n        _this_1._processRequestXml(req, res, xml);\n      });\n    } else {\n      res.end();\n    }\n  };\n\n  Server.prototype._getSoapAction = function (req) {\n    if (typeof req.headers.soapaction === 'undefined') {\n      return;\n    }\n\n    var soapAction = req.headers.soapaction;\n    return soapAction.indexOf('\"') === 0 ? soapAction.slice(1, -1) : soapAction;\n  };\n\n  Server.prototype._process = function (input, req, res, cb) {\n    var _this_1 = this;\n\n    var pathname = url.parse(req.url).pathname.replace(/\\/$/, '');\n    var obj = this.wsdl.xmlToObject(input);\n    var body = obj.Body;\n    var headers = obj.Header;\n    var binding;\n    var methodName;\n    var serviceName;\n    var portName;\n    var includeTimestamp = obj.Header && obj.Header.Security && obj.Header.Security.Timestamp;\n\n    var authenticate = this.authenticate || function defaultAuthenticate() {\n      return true;\n    };\n\n    var callback = function (result, statusCode) {\n      var response = {\n        result: result\n      };\n\n      _this_1.emit('response', response, methodName);\n\n      cb(response.result, statusCode);\n    };\n\n    var process = function () {\n      if (typeof _this_1.log === 'function') {\n        _this_1.log('info', 'Attempting to bind to ' + pathname);\n      } // Avoid Cannot convert undefined or null to object due to Object.keys(body)\n      // and throw more meaningful error\n\n\n      if (!body) {\n        throw new Error('Failed to parse the SOAP Message body');\n      } // use port.location and current url to find the right binding\n\n\n      binding = function () {\n        var services = _this_1.wsdl.definitions.services;\n        var firstPort;\n        var name;\n\n        for (name in services) {\n          serviceName = name;\n          var service = services[serviceName];\n          var ports = service.ports;\n\n          for (name in ports) {\n            portName = name;\n            var port = ports[portName];\n            var portPathname = url.parse(port.location).pathname.replace(/\\/$/, '');\n\n            if (typeof _this_1.log === 'function') {\n              _this_1.log('info', 'Trying ' + portName + ' from path ' + portPathname);\n            }\n\n            if (portPathname === pathname) {\n              return port.binding;\n            } // The port path is almost always wrong for generated WSDLs\n\n\n            if (!firstPort) {\n              firstPort = port;\n            }\n          }\n        }\n\n        return !firstPort ? void 0 : firstPort.binding;\n      }();\n\n      if (!binding) {\n        throw new Error('Failed to bind to WSDL');\n      }\n\n      try {\n        var soapAction = _this_1._getSoapAction(req);\n\n        var messageElemName = Object.keys(body)[0] === 'attributes' ? Object.keys(body)[1] : Object.keys(body)[0];\n        var pair = binding.topElements[messageElemName];\n\n        if (soapAction) {\n          methodName = _this_1._getMethodNameBySoapAction(binding, soapAction);\n        } else {\n          methodName = pair ? pair.methodName : messageElemName;\n        }\n        /** Style can be defined in method. If method has no style then look in binding */\n\n\n        var style = binding.methods[methodName].style || binding.style;\n\n        _this_1.emit('request', obj, methodName);\n\n        if (headers) {\n          _this_1.emit('headers', headers, methodName);\n        }\n\n        if (style === 'rpc') {\n          _this_1._executeMethod({\n            serviceName: serviceName,\n            portName: portName,\n            methodName: methodName,\n            outputName: messageElemName + 'Response',\n            args: body[messageElemName],\n            headers: headers,\n            style: 'rpc'\n          }, req, res, callback);\n        } else {\n          _this_1._executeMethod({\n            serviceName: serviceName,\n            portName: portName,\n            methodName: methodName,\n            outputName: pair.outputName,\n            args: body[messageElemName],\n            headers: headers,\n            style: 'document'\n          }, req, res, callback, includeTimestamp);\n        }\n      } catch (error) {\n        if (error.Fault !== undefined) {\n          return _this_1._sendError(error.Fault, callback, includeTimestamp);\n        }\n\n        throw error;\n      }\n    }; // Authentication\n\n\n    if (typeof authenticate === 'function') {\n      var authResultProcessed_1 = false;\n\n      var processAuthResult_1 = function (authResult) {\n        if (authResultProcessed_1) {\n          return;\n        }\n\n        authResultProcessed_1 = true; // Handle errors\n\n        if (authResult instanceof Error) {\n          return _this_1._sendError({\n            Code: {\n              Value: 'SOAP-ENV:Server',\n              Subcode: {\n                Value: 'InternalServerError'\n              }\n            },\n            Reason: {\n              Text: authResult.toString()\n            },\n            statusCode: 500\n          }, callback, includeTimestamp);\n        } // Handle actual results\n\n\n        if (typeof authResult === 'boolean') {\n          if (authResult === true) {\n            try {\n              process();\n            } catch (error) {\n              if (error.Fault !== undefined) {\n                return _this_1._sendError(error.Fault, callback, includeTimestamp);\n              }\n\n              return _this_1._sendError({\n                Code: {\n                  Value: 'SOAP-ENV:Server',\n                  Subcode: {\n                    Value: 'InternalServerError'\n                  }\n                },\n                Reason: {\n                  Text: error.toString()\n                },\n                statusCode: 500\n              }, callback, includeTimestamp);\n            }\n          } else {\n            return _this_1._sendError({\n              Code: {\n                Value: 'SOAP-ENV:Client',\n                Subcode: {\n                  Value: 'AuthenticationFailure'\n                }\n              },\n              Reason: {\n                Text: 'Invalid username or password'\n              },\n              statusCode: 401\n            }, callback, includeTimestamp);\n          }\n        }\n      };\n\n      var functionResult = authenticate(obj.Header && obj.Header.Security, processAuthResult_1, req, obj);\n\n      if (isPromiseLike(functionResult)) {\n        functionResult.then(function (result) {\n          processAuthResult_1(result);\n        }, function (err) {\n          processAuthResult_1(err);\n        });\n      }\n\n      if (typeof functionResult === 'boolean') {\n        processAuthResult_1(functionResult);\n      }\n    } else {\n      throw new Error('Invalid authenticate function (not a function)');\n    }\n  };\n\n  Server.prototype._getMethodNameBySoapAction = function (binding, soapAction) {\n    for (var methodName in binding.methods) {\n      if (binding.methods[methodName].soapAction === soapAction) {\n        return methodName;\n      }\n    }\n  };\n\n  Server.prototype._executeMethod = function (options, req, res, callback, includeTimestamp) {\n    var _this_1 = this;\n\n    options = options || {};\n    var method;\n    var body;\n    var headers;\n    var serviceName = options.serviceName;\n    var portName = options.portName;\n    var binding = this.wsdl.definitions.services[serviceName].ports[portName].binding;\n    var methodName = options.methodName;\n    var outputName = options.outputName;\n    var args = options.args;\n    var style = options.style;\n\n    if (this.soapHeaders) {\n      headers = this.soapHeaders.map(function (header) {\n        if (typeof header === 'function') {\n          return header(methodName, args, options.headers, req, res, _this_1);\n        } else {\n          return header;\n        }\n      }).join('\\n');\n    }\n\n    try {\n      method = this.services[serviceName][portName][methodName];\n    } catch (error) {\n      return callback(this._envelope('', headers, includeTimestamp));\n    }\n\n    var handled = false;\n\n    var handleResult = function (error, result) {\n      if (handled) {\n        return;\n      }\n\n      handled = true;\n\n      if (error) {\n        if (error.Fault !== undefined) {\n          return _this_1._sendError(error.Fault, callback, includeTimestamp);\n        } else {\n          return _this_1._sendError({\n            Code: {\n              Value: 'SOAP-ENV:Server',\n              Subcode: {\n                Value: 'InternalServerError'\n              }\n            },\n            Reason: {\n              Text: error.toString()\n            },\n            statusCode: 500\n          }, callback, includeTimestamp);\n        }\n      }\n\n      if (style === 'rpc') {\n        body = _this_1.wsdl.objectToRpcXML(outputName, result, '', _this_1.wsdl.definitions.$targetNamespace);\n      } else {\n        var element = binding.methods[methodName].output;\n        body = _this_1.wsdl.objectToDocumentXML(outputName, result, element.targetNSAlias, element.targetNamespace);\n      }\n\n      callback(_this_1._envelope(body, headers, includeTimestamp));\n    };\n\n    if (!binding.methods[methodName].output) {\n      // no output defined = one-way operation so return empty response\n      handled = true;\n      body = '';\n\n      if (this.onewayOptions.emptyBody) {\n        body = this._envelope('', headers, includeTimestamp);\n      }\n\n      callback(body, this.onewayOptions.responseCode);\n    }\n\n    var methodCallback = function (error, result) {\n      if (error && error.Fault !== undefined) {// do nothing\n      } else if (result === undefined) {\n        // Backward compatibility to support one argument callback style\n        result = error;\n        error = null;\n      }\n\n      handleResult(error, result);\n    };\n\n    var result = method(args, methodCallback, options.headers, req, res, this);\n\n    if (typeof result !== 'undefined') {\n      if (isPromiseLike(result)) {\n        result.then(function (value) {\n          handleResult(null, value);\n        }, function (err) {\n          handleResult(err);\n        });\n      } else {\n        handleResult(null, result);\n      }\n    }\n  };\n\n  Server.prototype._envelope = function (body, headers, includeTimestamp) {\n    var defs = this.wsdl.definitions;\n    var ns = defs.$targetNamespace;\n    var encoding = '';\n    var alias = utils_1.findPrefix(defs.xmlns, ns);\n    var envelopeDefinition = this.wsdl.options.forceSoap12Headers ? 'http://www.w3.org/2003/05/soap-envelope' : 'http://schemas.xmlsoap.org/soap/envelope/';\n    var xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>' + '<soap:Envelope xmlns:soap=\"' + envelopeDefinition + '\" ' + encoding + this.wsdl.xmlnsInEnvelope + '>';\n    headers = headers || '';\n\n    if (includeTimestamp) {\n      var now = new Date();\n      var created = getDateString(now);\n      var expires = getDateString(new Date(now.getTime() + 1000 * 600));\n      headers += '<o:Security soap:mustUnderstand=\"1\" ' + 'xmlns:o=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" ' + 'xmlns:u=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">' + '    <u:Timestamp u:Id=\"_0\">' + '      <u:Created>' + created + '</u:Created>' + '      <u:Expires>' + expires + '</u:Expires>' + '    </u:Timestamp>' + '  </o:Security>\\n';\n    }\n\n    if (headers !== '') {\n      xml += '<soap:Header>' + headers + '</soap:Header>';\n    }\n\n    xml += body ? '<soap:Body>' + body + '</soap:Body>' : '<soap:Body/>';\n    xml += '</soap:Envelope>';\n    return xml;\n  };\n\n  Server.prototype._sendError = function (soapFault, callback, includeTimestamp) {\n    var fault;\n    var statusCode;\n\n    if (soapFault.statusCode) {\n      statusCode = soapFault.statusCode;\n      soapFault.statusCode = undefined;\n    }\n\n    if ('faultcode' in soapFault) {\n      // Soap 1.1 error style\n      // Root element will be prependend with the soap NS\n      // It must match the NS defined in the Envelope (set by the _envelope method)\n      fault = this.wsdl.objectToDocumentXML('soap:Fault', soapFault, undefined);\n    } else {\n      // Soap 1.2 error style.\n      // 3rd param is the NS prepended to all elements\n      // It must match the NS defined in the Envelope (set by the _envelope method)\n      fault = this.wsdl.objectToDocumentXML('Fault', soapFault, 'soap');\n    }\n\n    return callback(this._envelope(fault, '', includeTimestamp), statusCode);\n  };\n\n  Server.prototype._sendHttpResponse = function (res, statusCode, result) {\n    if (statusCode) {\n      res.statusCode = statusCode;\n    }\n    /*\n    * Calling res.write(result) follow by res.end() will cause Node.js to use\n    * chunked encoding, while calling res.end(result) directly will cause\n    * Node.js to calculate and send Content-Length header. See\n    * nodejs/node#26005.\n    */\n\n\n    if (this.enableChunkedEncoding) {\n      res.write(result);\n      res.end();\n    } else {\n      res.end(result);\n    }\n  };\n\n  return Server;\n}(events_1.EventEmitter);\n\nexports.Server = Server;","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","exports","__esModule","Server","events_1","require","url","utils_1","zlib","error","isExpress","server","route","use","isPromiseLike","obj","then","getDateString","pad","n","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","_super","path","services","wsdl","options","_this_1","call","suppressStack","returnFault","onewayOptions","oneWay","enableChunkedEncoding","undefined","callback","length","RegExp","source","onReady","err","all","req","res","authorizeConnection","end","_requestListener","listeners_1","listeners","slice","removeAllListeners","addListener","reqPath","parse","pathname","match","i","len","_initializeOptions","addSoapHeader","soapHeader","name","namespace","xmlns","soapHeaders","_processSoapHeader","push","changeSoapHeader","index","getSoapHeaders","clearSoapHeaders","objectToXML","_this_2","result","apply","arguments","attributesKey","statusCode","responseCode","emptyBody","_processRequestXml","xml","log","_process","_sendHttpResponse","Fault","_sendError","Date","toISOString","stack","message","reqParse","reqQuery","search","method","toLowerCase","startsWith","setHeader","write","toXML","headers","body","toString","chunks_1","gunzip","createGunzip","pipe","on","chunk","Buffer","concat","_getSoapAction","soapaction","soapAction","indexOf","input","cb","replace","xmlToObject","Body","Header","binding","methodName","serviceName","portName","includeTimestamp","Security","Timestamp","authenticate","defaultAuthenticate","response","emit","process","Error","definitions","firstPort","service","ports","port","portPathname","location","messageElemName","keys","pair","topElements","_getMethodNameBySoapAction","style","methods","_executeMethod","outputName","args","authResultProcessed_1","processAuthResult_1","authResult","Code","Value","Subcode","Reason","Text","functionResult","map","header","join","_envelope","handled","handleResult","objectToRpcXML","$targetNamespace","element","output","objectToDocumentXML","targetNSAlias","targetNamespace","methodCallback","value","defs","ns","encoding","alias","findPrefix","envelopeDefinition","forceSoap12Headers","xmlnsInEnvelope","now","created","expires","getTime","soapFault","fault","EventEmitter"],"sources":["C:/Users/ayber/node_modules/soap/lib/server.js"],"sourcesContent":["\"use strict\";\n/*\n * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>\n * MIT Licensed\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nexports.__esModule = true;\nexports.Server = void 0;\nvar events_1 = require(\"events\");\nvar url = require(\"url\");\nvar utils_1 = require(\"./utils\");\nvar zlib;\ntry {\n    zlib = require('zlib');\n}\ncatch (error) {\n}\nfunction isExpress(server) {\n    return (typeof server.route === 'function' && typeof server.use === 'function');\n}\nfunction isPromiseLike(obj) {\n    return (!!obj && typeof obj.then === 'function');\n}\nfunction getDateString(d) {\n    function pad(n) {\n        return n < 10 ? '0' + n : n;\n    }\n    return d.getUTCFullYear() + '-'\n        + pad(d.getUTCMonth() + 1) + '-'\n        + pad(d.getUTCDate()) + 'T'\n        + pad(d.getUTCHours()) + ':'\n        + pad(d.getUTCMinutes()) + ':'\n        + pad(d.getUTCSeconds()) + 'Z';\n}\nvar Server = /** @class */ (function (_super) {\n    __extends(Server, _super);\n    function Server(server, path, services, wsdl, options) {\n        var _this_1 = _super.call(this) || this;\n        options = options || {\n            path: path,\n            services: services\n        };\n        _this_1.path = path;\n        _this_1.services = services;\n        _this_1.wsdl = wsdl;\n        _this_1.suppressStack = options && options.suppressStack;\n        _this_1.returnFault = options && options.returnFault;\n        _this_1.onewayOptions = options && options.oneWay || {};\n        _this_1.enableChunkedEncoding =\n            options.enableChunkedEncoding === undefined ? true : !!options.enableChunkedEncoding;\n        _this_1.callback = options.callback ? options.callback : function () { };\n        if (typeof path === 'string' && path[path.length - 1] !== '/') {\n            path += '/';\n        }\n        else if (path instanceof RegExp && path.source[path.source.length - 1] !== '/') {\n            path = new RegExp(path.source + '(?:\\\\/|)');\n        }\n        wsdl.onReady(function (err) {\n            if (isExpress(server)) {\n                // handle only the required URL path for express server\n                server.route(path).all(function (req, res) {\n                    if (typeof _this_1.authorizeConnection === 'function') {\n                        if (!_this_1.authorizeConnection(req, res)) {\n                            res.end();\n                            return;\n                        }\n                    }\n                    _this_1._requestListener(req, res);\n                });\n                _this_1.callback(err, _this_1);\n            }\n            else {\n                var listeners_1 = server.listeners('request').slice();\n                server.removeAllListeners('request');\n                server.addListener('request', function (req, res) {\n                    if (typeof _this_1.authorizeConnection === 'function') {\n                        if (!_this_1.authorizeConnection(req, res)) {\n                            res.end();\n                            return;\n                        }\n                    }\n                    var reqPath = url.parse(req.url).pathname;\n                    if (reqPath[reqPath.length - 1] !== '/') {\n                        reqPath += '/';\n                    }\n                    if (path === reqPath || (path instanceof RegExp && reqPath.match(path))) {\n                        _this_1._requestListener(req, res);\n                    }\n                    else {\n                        for (var i = 0, len = listeners_1.length; i < len; i++) {\n                            listeners_1[i].call(_this_1, req, res);\n                        }\n                    }\n                });\n                _this_1.callback(err, _this_1);\n            }\n        });\n        _this_1._initializeOptions(options);\n        return _this_1;\n    }\n    Server.prototype.addSoapHeader = function (soapHeader, name, namespace, xmlns) {\n        if (!this.soapHeaders) {\n            this.soapHeaders = [];\n        }\n        soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n        return this.soapHeaders.push(soapHeader) - 1;\n    };\n    Server.prototype.changeSoapHeader = function (index, soapHeader, name, namespace, xmlns) {\n        if (!this.soapHeaders) {\n            this.soapHeaders = [];\n        }\n        soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n        this.soapHeaders[index] = soapHeader;\n    };\n    Server.prototype.getSoapHeaders = function () {\n        return this.soapHeaders;\n    };\n    Server.prototype.clearSoapHeaders = function () {\n        this.soapHeaders = null;\n    };\n    Server.prototype._processSoapHeader = function (soapHeader, name, namespace, xmlns) {\n        switch (typeof soapHeader) {\n            case 'object':\n                return this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);\n            case 'function':\n                var _this_2 = this;\n                // arrow function does not support arguments variable\n                // tslint:disable-next-line\n                return function () {\n                    var result = soapHeader.apply(null, arguments);\n                    if (typeof result === 'object') {\n                        return _this_2.wsdl.objectToXML(result, name, namespace, xmlns, true);\n                    }\n                    else {\n                        return result;\n                    }\n                };\n            default:\n                return soapHeader;\n        }\n    };\n    Server.prototype._initializeOptions = function (options) {\n        this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n        this.onewayOptions.statusCode = this.onewayOptions.responseCode || 200;\n        this.onewayOptions.emptyBody = !!this.onewayOptions.emptyBody;\n    };\n    Server.prototype._processRequestXml = function (req, res, xml) {\n        var _this_1 = this;\n        var error;\n        try {\n            if (typeof this.log === 'function') {\n                this.log('received', xml);\n            }\n            this._process(xml, req, res, function (result, statusCode) {\n                _this_1._sendHttpResponse(res, statusCode, result);\n                if (typeof _this_1.log === 'function') {\n                    _this_1.log('replied', result);\n                }\n            });\n        }\n        catch (err) {\n            if (err.Fault !== undefined) {\n                return this._sendError(err.Fault, function (result, statusCode) {\n                    _this_1._sendHttpResponse(res, statusCode || 500, result);\n                    if (typeof _this_1.log === 'function') {\n                        _this_1.log('error', err);\n                    }\n                }, new Date().toISOString());\n            }\n            else {\n                error = err.stack ? (this.suppressStack === true ? err.message : err.stack) : err;\n                this._sendHttpResponse(res, /* statusCode */ 500, error);\n                if (typeof this.log === 'function') {\n                    this.log('error', error);\n                }\n            }\n        }\n    };\n    Server.prototype._requestListener = function (req, res) {\n        var _this_1 = this;\n        var reqParse = url.parse(req.url);\n        var reqPath = reqParse.pathname;\n        var reqQuery = reqParse.search;\n        if (typeof this.log === 'function') {\n            this.log('info', 'Handling ' + req.method + ' on ' + req.url);\n        }\n        if (req.method === 'GET') {\n            if (reqQuery && reqQuery.toLowerCase().startsWith('?wsdl')) {\n                if (typeof this.log === 'function') {\n                    this.log('info', 'Wants the WSDL');\n                }\n                res.setHeader('Content-Type', 'application/xml');\n                res.write(this.wsdl.toXML());\n            }\n            res.end();\n        }\n        else if (req.method === 'POST') {\n            if (typeof req.headers['content-type'] !== 'undefined') {\n                res.setHeader('Content-Type', req.headers['content-type']);\n            }\n            else {\n                res.setHeader('Content-Type', 'application/xml');\n            }\n            // request body is already provided by an express middleware\n            // in this case unzipping should also be done by the express middleware itself\n            if (req.body && req.body.length > 0) {\n                return this._processRequestXml(req, res, req.body.toString());\n            }\n            var chunks_1 = [];\n            var gunzip = void 0;\n            var source = req;\n            if (req.headers['content-encoding'] === 'gzip') {\n                gunzip = zlib.createGunzip();\n                req.pipe(gunzip);\n                source = gunzip;\n            }\n            source.on('data', function (chunk) {\n                chunks_1.push(chunk);\n            });\n            source.on('end', function () {\n                var xml = Buffer.concat(chunks_1).toString();\n                _this_1._processRequestXml(req, res, xml);\n            });\n        }\n        else {\n            res.end();\n        }\n    };\n    Server.prototype._getSoapAction = function (req) {\n        if (typeof req.headers.soapaction === 'undefined') {\n            return;\n        }\n        var soapAction = req.headers.soapaction;\n        return (soapAction.indexOf('\"') === 0)\n            ? soapAction.slice(1, -1)\n            : soapAction;\n    };\n    Server.prototype._process = function (input, req, res, cb) {\n        var _this_1 = this;\n        var pathname = url.parse(req.url).pathname.replace(/\\/$/, '');\n        var obj = this.wsdl.xmlToObject(input);\n        var body = obj.Body;\n        var headers = obj.Header;\n        var binding;\n        var methodName;\n        var serviceName;\n        var portName;\n        var includeTimestamp = obj.Header && obj.Header.Security && obj.Header.Security.Timestamp;\n        var authenticate = this.authenticate || function defaultAuthenticate() { return true; };\n        var callback = function (result, statusCode) {\n            var response = { result: result };\n            _this_1.emit('response', response, methodName);\n            cb(response.result, statusCode);\n        };\n        var process = function () {\n            if (typeof _this_1.log === 'function') {\n                _this_1.log('info', 'Attempting to bind to ' + pathname);\n            }\n            // Avoid Cannot convert undefined or null to object due to Object.keys(body)\n            // and throw more meaningful error\n            if (!body) {\n                throw new Error('Failed to parse the SOAP Message body');\n            }\n            // use port.location and current url to find the right binding\n            binding = (function () {\n                var services = _this_1.wsdl.definitions.services;\n                var firstPort;\n                var name;\n                for (name in services) {\n                    serviceName = name;\n                    var service = services[serviceName];\n                    var ports = service.ports;\n                    for (name in ports) {\n                        portName = name;\n                        var port = ports[portName];\n                        var portPathname = url.parse(port.location).pathname.replace(/\\/$/, '');\n                        if (typeof _this_1.log === 'function') {\n                            _this_1.log('info', 'Trying ' + portName + ' from path ' + portPathname);\n                        }\n                        if (portPathname === pathname) {\n                            return port.binding;\n                        }\n                        // The port path is almost always wrong for generated WSDLs\n                        if (!firstPort) {\n                            firstPort = port;\n                        }\n                    }\n                }\n                return !firstPort ? void 0 : firstPort.binding;\n            })();\n            if (!binding) {\n                throw new Error('Failed to bind to WSDL');\n            }\n            try {\n                var soapAction = _this_1._getSoapAction(req);\n                var messageElemName = (Object.keys(body)[0] === 'attributes' ? Object.keys(body)[1] : Object.keys(body)[0]);\n                var pair = binding.topElements[messageElemName];\n                if (soapAction) {\n                    methodName = _this_1._getMethodNameBySoapAction(binding, soapAction);\n                }\n                else {\n                    methodName = pair ? pair.methodName : messageElemName;\n                }\n                /** Style can be defined in method. If method has no style then look in binding */\n                var style = binding.methods[methodName].style || binding.style;\n                _this_1.emit('request', obj, methodName);\n                if (headers) {\n                    _this_1.emit('headers', headers, methodName);\n                }\n                if (style === 'rpc') {\n                    _this_1._executeMethod({\n                        serviceName: serviceName,\n                        portName: portName,\n                        methodName: methodName,\n                        outputName: messageElemName + 'Response',\n                        args: body[messageElemName],\n                        headers: headers,\n                        style: 'rpc'\n                    }, req, res, callback);\n                }\n                else {\n                    _this_1._executeMethod({\n                        serviceName: serviceName,\n                        portName: portName,\n                        methodName: methodName,\n                        outputName: pair.outputName,\n                        args: body[messageElemName],\n                        headers: headers,\n                        style: 'document'\n                    }, req, res, callback, includeTimestamp);\n                }\n            }\n            catch (error) {\n                if (error.Fault !== undefined) {\n                    return _this_1._sendError(error.Fault, callback, includeTimestamp);\n                }\n                throw error;\n            }\n        };\n        // Authentication\n        if (typeof authenticate === 'function') {\n            var authResultProcessed_1 = false;\n            var processAuthResult_1 = function (authResult) {\n                if (authResultProcessed_1) {\n                    return;\n                }\n                authResultProcessed_1 = true;\n                // Handle errors\n                if (authResult instanceof Error) {\n                    return _this_1._sendError({\n                        Code: {\n                            Value: 'SOAP-ENV:Server',\n                            Subcode: { Value: 'InternalServerError' }\n                        },\n                        Reason: { Text: authResult.toString() },\n                        statusCode: 500\n                    }, callback, includeTimestamp);\n                }\n                // Handle actual results\n                if (typeof authResult === 'boolean') {\n                    if (authResult === true) {\n                        try {\n                            process();\n                        }\n                        catch (error) {\n                            if (error.Fault !== undefined) {\n                                return _this_1._sendError(error.Fault, callback, includeTimestamp);\n                            }\n                            return _this_1._sendError({\n                                Code: {\n                                    Value: 'SOAP-ENV:Server',\n                                    Subcode: { Value: 'InternalServerError' }\n                                },\n                                Reason: { Text: error.toString() },\n                                statusCode: 500\n                            }, callback, includeTimestamp);\n                        }\n                    }\n                    else {\n                        return _this_1._sendError({\n                            Code: {\n                                Value: 'SOAP-ENV:Client',\n                                Subcode: { Value: 'AuthenticationFailure' }\n                            },\n                            Reason: { Text: 'Invalid username or password' },\n                            statusCode: 401\n                        }, callback, includeTimestamp);\n                    }\n                }\n            };\n            var functionResult = authenticate(obj.Header && obj.Header.Security, processAuthResult_1, req, obj);\n            if (isPromiseLike(functionResult)) {\n                functionResult.then(function (result) {\n                    processAuthResult_1(result);\n                }, function (err) {\n                    processAuthResult_1(err);\n                });\n            }\n            if (typeof functionResult === 'boolean') {\n                processAuthResult_1(functionResult);\n            }\n        }\n        else {\n            throw new Error('Invalid authenticate function (not a function)');\n        }\n    };\n    Server.prototype._getMethodNameBySoapAction = function (binding, soapAction) {\n        for (var methodName in binding.methods) {\n            if (binding.methods[methodName].soapAction === soapAction) {\n                return methodName;\n            }\n        }\n    };\n    Server.prototype._executeMethod = function (options, req, res, callback, includeTimestamp) {\n        var _this_1 = this;\n        options = options || {};\n        var method;\n        var body;\n        var headers;\n        var serviceName = options.serviceName;\n        var portName = options.portName;\n        var binding = this.wsdl.definitions.services[serviceName].ports[portName].binding;\n        var methodName = options.methodName;\n        var outputName = options.outputName;\n        var args = options.args;\n        var style = options.style;\n        if (this.soapHeaders) {\n            headers = this.soapHeaders.map(function (header) {\n                if (typeof header === 'function') {\n                    return header(methodName, args, options.headers, req, res, _this_1);\n                }\n                else {\n                    return header;\n                }\n            }).join('\\n');\n        }\n        try {\n            method = this.services[serviceName][portName][methodName];\n        }\n        catch (error) {\n            return callback(this._envelope('', headers, includeTimestamp));\n        }\n        var handled = false;\n        var handleResult = function (error, result) {\n            if (handled) {\n                return;\n            }\n            handled = true;\n            if (error) {\n                if (error.Fault !== undefined) {\n                    return _this_1._sendError(error.Fault, callback, includeTimestamp);\n                }\n                else {\n                    return _this_1._sendError({\n                        Code: {\n                            Value: 'SOAP-ENV:Server',\n                            Subcode: { Value: 'InternalServerError' }\n                        },\n                        Reason: { Text: error.toString() },\n                        statusCode: 500\n                    }, callback, includeTimestamp);\n                }\n            }\n            if (style === 'rpc') {\n                body = _this_1.wsdl.objectToRpcXML(outputName, result, '', _this_1.wsdl.definitions.$targetNamespace);\n            }\n            else {\n                var element = binding.methods[methodName].output;\n                body = _this_1.wsdl.objectToDocumentXML(outputName, result, element.targetNSAlias, element.targetNamespace);\n            }\n            callback(_this_1._envelope(body, headers, includeTimestamp));\n        };\n        if (!binding.methods[methodName].output) {\n            // no output defined = one-way operation so return empty response\n            handled = true;\n            body = '';\n            if (this.onewayOptions.emptyBody) {\n                body = this._envelope('', headers, includeTimestamp);\n            }\n            callback(body, this.onewayOptions.responseCode);\n        }\n        var methodCallback = function (error, result) {\n            if (error && error.Fault !== undefined) {\n                // do nothing\n            }\n            else if (result === undefined) {\n                // Backward compatibility to support one argument callback style\n                result = error;\n                error = null;\n            }\n            handleResult(error, result);\n        };\n        var result = method(args, methodCallback, options.headers, req, res, this);\n        if (typeof result !== 'undefined') {\n            if (isPromiseLike(result)) {\n                result.then(function (value) {\n                    handleResult(null, value);\n                }, function (err) {\n                    handleResult(err);\n                });\n            }\n            else {\n                handleResult(null, result);\n            }\n        }\n    };\n    Server.prototype._envelope = function (body, headers, includeTimestamp) {\n        var defs = this.wsdl.definitions;\n        var ns = defs.$targetNamespace;\n        var encoding = '';\n        var alias = utils_1.findPrefix(defs.xmlns, ns);\n        var envelopeDefinition = this.wsdl.options.forceSoap12Headers\n            ? 'http://www.w3.org/2003/05/soap-envelope'\n            : 'http://schemas.xmlsoap.org/soap/envelope/';\n        var xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>' +\n            '<soap:Envelope xmlns:soap=\"' + envelopeDefinition + '\" ' +\n            encoding +\n            this.wsdl.xmlnsInEnvelope + '>';\n        headers = headers || '';\n        if (includeTimestamp) {\n            var now = new Date();\n            var created = getDateString(now);\n            var expires = getDateString(new Date(now.getTime() + (1000 * 600)));\n            headers += '<o:Security soap:mustUnderstand=\"1\" ' +\n                'xmlns:o=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" ' +\n                'xmlns:u=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">' +\n                '    <u:Timestamp u:Id=\"_0\">' +\n                '      <u:Created>' + created + '</u:Created>' +\n                '      <u:Expires>' + expires + '</u:Expires>' +\n                '    </u:Timestamp>' +\n                '  </o:Security>\\n';\n        }\n        if (headers !== '') {\n            xml += '<soap:Header>' + headers + '</soap:Header>';\n        }\n        xml += body ? '<soap:Body>' + body + '</soap:Body>' : '<soap:Body/>';\n        xml += '</soap:Envelope>';\n        return xml;\n    };\n    Server.prototype._sendError = function (soapFault, callback, includeTimestamp) {\n        var fault;\n        var statusCode;\n        if (soapFault.statusCode) {\n            statusCode = soapFault.statusCode;\n            soapFault.statusCode = undefined;\n        }\n        if ('faultcode' in soapFault) {\n            // Soap 1.1 error style\n            // Root element will be prependend with the soap NS\n            // It must match the NS defined in the Envelope (set by the _envelope method)\n            fault = this.wsdl.objectToDocumentXML('soap:Fault', soapFault, undefined);\n        }\n        else {\n            // Soap 1.2 error style.\n            // 3rd param is the NS prepended to all elements\n            // It must match the NS defined in the Envelope (set by the _envelope method)\n            fault = this.wsdl.objectToDocumentXML('Fault', soapFault, 'soap');\n        }\n        return callback(this._envelope(fault, '', includeTimestamp), statusCode);\n    };\n    Server.prototype._sendHttpResponse = function (res, statusCode, result) {\n        if (statusCode) {\n            res.statusCode = statusCode;\n        }\n        /*\n        * Calling res.write(result) follow by res.end() will cause Node.js to use\n        * chunked encoding, while calling res.end(result) directly will cause\n        * Node.js to calculate and send Content-Length header. See\n        * nodejs/node#26005.\n        */\n        if (this.enableChunkedEncoding) {\n            res.write(result);\n            res.end();\n        }\n        else {\n            res.end(result);\n        }\n    };\n    return Server;\n}(events_1.EventEmitter));\nexports.Server = Server;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}